{"version":3,"file":"list.js","sourceRoot":"./","sources":["handlers/list.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, {RefObject, Dispatch, SetStateAction, useEffect, useState, useCallback, useRef, FC, KeyboardEvent } from \"react\";\nimport {DefaultElementHandler, FixedList} from \"../types\";\nimport { TokensList } from \"marked\";\n\nimport code from \"./code\";\n\ntype HandledElements = \"code\" | \"table\";\n\nconst getListItems = (list: FixedList) => {\n\tconst counts: Record<HandledElements, number> = {\n\t\tcode: 0,\n\t\ttable: 0\n\t};\n\n\tlist.items.reduce((acc, listItem) => {\n\t\tlistItem.tokens.forEach(token => {\n\t\t\tswitch(token.type) {\n\t\t\t\tcase \"code\":\n\t\t\t\tcase \"table\":\n\t\t\t\t\tcounts[token.type]++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t}\n\t\t});\n\n\t\treturn acc;\n\t}, counts);\n\n\treturn \"-\" + Object.keys(counts).reduce((acc, k) => {\n\t\tif (counts[k as HandledElements]) {\n\t\t\tacc.push(`${k}-${counts[k as HandledElements]}`);\n\t\t}\n\n\t\treturn acc;\n\t}, [] as Array<string>).join(\"-\");\n}\n\nconst keyupHandler = (ulElement: RefObject<HTMLUListElement>, setCurrentFocus: Dispatch<SetStateAction<number>>) => (event: KeyboardEvent<HTMLUListElement>) => {\n\tlet currentFocusIndex = -1;\n\n\tif (ulElement.current) {\n\t\tconst childCount = ulElement.current.children.length;\n\n\t\tfor (let i = 0; i < childCount; i++) {\n\t\t\tif (ulElement.current.children[i] === document.activeElement) {\n\t\t\t\tcurrentFocusIndex = i;\n\t\t\t}\n\t\t}\n\n\t\tswitch (event.key) {\n\t\t\tcase \"ArrowDown\":\n\t\t\t\tsetCurrentFocus((currentFocusIndex + 1) % childCount);\n\t\t\t\tbreak;\n\n\t\t\tcase \"ArrowUp\":\n\t\t\t\tsetCurrentFocus((currentFocusIndex - 1 + childCount) % childCount);\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nconst list: DefaultElementHandler = (t, context, parser): [FC, string] => [\n\t() => {\n\t\tconst [currentFocus, setCurrentFocus] = useState(0);\n\t\tconst ulElement = useRef<HTMLUListElement>(null);\n\t\tconst onKeyUp = useCallback(\n\t\t\tkeyupHandler(ulElement, setCurrentFocus),\n\t\t\t[ulElement, ulElement.current]\n\t\t);\n\n\t\tconst { items } = t as FixedList;\n\n\t\tuseEffect(() => {\n\t\t\tif (ulElement.current && ulElement.current.children[currentFocus]) {\n\t\t\t\t(ulElement.current.children[currentFocus] as HTMLUListElement).focus();\n\t\t\t}\n\n\t\t}, [ulElement, currentFocus]);\n\n\t\treturn (\n\t\t\t<ul onKeyUp={onKeyUp} ref={ulElement}>\n\t\t\t\t<li tabIndex={1} className=\"list-blank\"></li>\n\t\t\t\t{items.map((i, n) => (\n\t\t\t\t\t<li\n\t\t\t\t\t\tkey={n + 1}\n\t\t\t\t\t\ttabIndex={n + 1}\n\n\t\t\t\t\t>\n\t\t\t\t\t\t{i.tokens.map(token => {\n\t\t\t\t\t\t\tswitch (token.type) {\n\t\t\t\t\t\t\t\tcase \"code\":\n\t\t\t\t\t\t\t\t\t(token as any).ignore = true;\n\t\t\t\t\t\t\t\t\tconst CodeComponent = code(token, context, parser);\n\n\t\t\t\t\t\t\t\t\tif (typeof CodeComponent === \"function\") {\n\t\t\t\t\t\t\t\t\t\treturn (<CodeComponent />);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\treturn (<span dangerouslySetInnerHTML={{__html: parser(([token] as any) as TokensList)}} />);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})}\n\t\t\t\t\t</li>\n\t\t\t\t))}\n\t\t\t</ul>\n\t\t);\n\t},\n\t`li-${(t as FixedList).items.length}${getListItems(t as FixedList)}`\n];\n\nexport default list;\n"]}